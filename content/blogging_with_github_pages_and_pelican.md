Title: Blogging with GitHub Pages and Pelican Step by Step
Date: 2016-01-18 22:20
Category: Post
Tags: Pelican, GitHub Pages

**[GitHub Pages](https://pages.github.com/)** is a service provide by GitHub to allow people having websites out of the content of their Repo. 
As you know, **[DanielDai.com](http://danieldai.com)** is hosted on **[GitHub Pages](https://pages.github.com/)**. The content of Website Repo can be static HTML files, with related CSS, Javascript and image resources, or it can be Markdown files writen is way supported by [Jekyll](http://jekyllrb.com/]), GitHub Pages has built support for [Jekyll](http://jekyllrb.com/]), it will convert Markdown to HTML.

If you do not want to install [Jekyll](http://jekyllrb.com/]),but still want to write blog in Markdown, you can use a static site generator, This site is built with such a tool called **[Pelican](http://getpelican.com/)**, a static site generaotr written in **[Python](http://python.org/)**. 

I'm going to tell you how to blog with **GitHub Pages** and **Pelican** from scratch in this article.

## 1. Setup the Repository

First, you need to create a repo on GitHub to contain the content of the blog. Please follow the [guides](https://pages.github.com/) provided by **GitHub Pages** to setup the repo. If you are creating a user site, the name of the repo would be `username.github.io`. At last you should have your repo cloned to your local machine:

```
git clone https://github.com/username/username.github.io
```

As the content of the site must be on `master` branch, which is required by GitHub Pages, to keep the repo clean, I will use a seperated branch to contain the source code. I choosed to use `source` name the branch, you can choose any name you like except `master`

```
git checkout -b source
```

### How `master` and `source` branchs related to each other?

Unlike normal git repositories, in this repo, `master` branch and `source` branches are 2 parallel branches that only share a common parent, but will never merge together in future. The content of each commits on `master` branch is generated output by Pelican from the content of some commits on `source` branch, and usually `source` branch has more commits than `master` branch.

```
o----o----o----o----o----o master branch
 \
  \---o--o--o--o--o--o--o--o--o--o--o--o--o--o--o source branch    
```    

each commit on `master` branch is the compiled result of on commit on `source` branch

## 2. Install Pelican

Next, install Pelican and other utils on your local machine. Use your favorite text editor create a new files called `requirements.txt`, add the following lines to this file:

```
markdown
pelican
typogrify
fabric
ghp-import
```

And then run

``` 
pip install -r requirements.txt
```
If you like, you can save current state of `source` as a new commit.

## 3. Start Pelican Project

Run this command in repo dir, to start a new Pelican project:

```
pelican-quickstart
```

Pelican will ask you some questions:

```
(danidai)ming/tmp/pel$ pelican-quickstart
Welcome to pelican-quickstart v3.6.3.

This script will help you create a new Pelican-based website.

Please answer the following questions so this script can generate the files
needed by Pelican.


> Where do you want to create your new web site? [.]
> What will be the title of this web site? Pelican site
> Who will be the author of this web site? Daniel Dai
> What will be the default language of this web site? [en]
> Do you want to specify a URL prefix? e.g., http://example.com   (Y/n)
> What is your URL prefix? (see above example; no trailing slash)
You must enter something
> What is your URL prefix? (see above example; no trailing slash) http://danieldai.com
> Do you want to enable article pagination? (Y/n) Y
> How many articles per page do you want? [10]
> What is your time zone? [Europe/Paris]
> Do you want to generate a Fabfile/Makefile to automate generation and publishing? (Y/n)
> Do you want an auto-reload & simpleHTTP script to assist with theme and site development? (Y/n)
> Do you want to upload your website using FTP? (y/N)
> Do you want to upload your website using SSH? (y/N)
> Do you want to upload your website using Dropbox? (y/N)
> Do you want to upload your website using S3? (y/N)
> Do you want to upload your website using Rackspace Cloud Files? (y/N)
> Do you want to upload your website using GitHub Pages? (y/N) y
> Is this your personal page (username.github.io)? (y/N) danieldai.github.io
You must answer 'yes' or 'no'
> Is this your personal page (username.github.io)? (y/N) y
Done. Your new project is available at /private/tmp/pel
```

These are the files generated by Pelican:

```
(danidai)ming/tmp/pel$ find .
.
./content             # the content of the site goes here
./develop_server.sh
./fabfile.py
./Makefile
./output
./pelicanconf.py
./publishconf.py
```
Create some example files in `content` diretory. You can get more tips on who to write from [Pelican docs](http://docs.getpelican.com/en/3.6.3/index.html)

### Customize Fabric file

As we are going to publish the site to GitHub Pages, we need to customize `fabfile.py` a bit. First, tell Pelican our GitHub Pages Branch is `master`:

```python
# Github Pages configuration
env.github_pages_branch = "master"
```

Then add 2 fabric commands to output generated site to master branch,and push master branch to GitHub Pages:

```python
def pages(comment):
    """Prepare GitHub Pages, put it on master branch"""
    rebuild()
    env.comment=comment
    local("ghp-import -m '{comment}' -b {github_pages_branch} {deploy_path}".format(**env))

def push():
    """Publish GibHub Pages"""
    local("git push origin {github_pages_branch}".format(**env))

``` 

`ghp-import` plays a very important role here. Pelican put the generated site in `output` directory, `ghp-import` takes the content of `output` directory, and outout it to `master` branch of current repo.


* compile content in to HTML

```
fab build
```

* start dev server

```
fab serve
```

* visit http://localhost:8888 to review it
* publish to `master` branch

```
fab pages:'<commit message for master branch>'
```

* publish to GitHub Pages

```
fab push
```

* push source branch

```
git add .
git commit -m "<commit message for source branch"
git push
```

Visit `username.github.io` with your favorite Browser, your new Blog site is on GitHub Pages now. 

If you meet any problem, please feel free to checkout my site repo https://github.com/danieldai/danieldai.github.io