Title: VPP命令行
Date: 2021-09-22 22:20
Slug: vpp_cli
Category: VPP
Tags: VPP, CLI
Status: published


## 导言

vpp网络堆栈配备了一组用于调试的命令。

访问CLI（具有适当权限）的最简单方法是使用vppctl命令：

```bash
sudo vppctl <cli command>
```

CLI解析器匹配静态关键字字符串，最终调用操作函数。明确的部分关键字匹配总是发生。操作函数消耗输入，直到满足或失败。这种模型易于编码，但不能保证有用的“帮助”输出。由CLI命令编写器来添加有用的帮助字符串。

您可以通过在代码源文件中搜索`VLIB_CLI_COMMAND` 宏的实例来找到CLI命令的源代码。


## 调试和Telnet CLI

调试CLI通过`unix interactive`参数或启动配置选项启用。这将导致VPP在没有后台化的情况下启动，并在运行它的终端上显示命令行界面。

Telnet CLI启用了`cli-listen localhost:5002`选项，这将导致VPP监听localhost地址端口5002上的TCP连接。然后Telnet客户端可以连接到该端口（例如，`telnet localhost 5002`），并将收到命令行提示符。

这一配置将使这两种机制成为可能：

```bash
unix {
  interactive
  cli-listen localhost:5002
}
```

调试CLI可以以行模式运行，这在像Emacs这样的集成开发环境中运行时可能很有用。这是通过选项`unix cli-line-mode`启用的。还有其他几个选项可以改变这个CLI的工作方式，详情请参阅VPP/Command-line_Arguments。

CLI以横幅图形（可以禁用）和提示符开始。提示符通常为VPP发布版本的`vpp`和启用调试的开发版本的`DBGvpp#`，例如：

```text
    _______    _        _   _____  ___ 
 __/ __/ _ \  (_)__    | | / / _ \/ _ \
 _/ _// // / / / _ \   | |/ / ___/ ___/
 /_/ /____(_)_/\___/   |___/_/  /_/    

vpp# 
```

与：

```text
    _______    _        _   _____  ___ 
 __/ __/ _ \  (_)__    | | / / _ \/ _ \
 _/ _// // / / / _ \   | |/ / ___/ ___/
 /_/ /____(_)_/\___/   |___/_/  /_/    

DBGvpp# 
```

这个提示符可以配置为`unix cli-prompt`符设置，并通过`unix cli-no-banner`禁用横幅。

## CLI功能

CLI有几个编辑功能，使其易于使用。

- 光标键左/右将在命令行内移动光标；打字将在光标处插入；擦除将在光标处擦除。
- Ctrl-左/右将搜索左或右的下一个单词的开头。
- Home/end将光标跳转到行的开始和结束。
- 游标键向上/向下和`^P`/`^N`遍历命令历史缓冲区。历史缓冲区中的行可以编辑。执行时，新命令将添加到缓冲区的末尾；尽管不添加先前命令的副本。
- `^U`擦除从光标左边到开始的行内容。`^K`擦除从光标到结束的内容。
- `^R`将向前或反向搜索命令历史记录中的命令；开始键入匹配项以自动完成。
- `^L`将清除屏幕并重新绘制提示和任何当前行。光标位置也将保留。
- CLI可以通过`exit`命令关闭。或者，在空行上的输入`^D`也将关闭会话。
- 关闭调试会话也将关闭VPP

超过终端页面长度的输出将被缓存，直到有缓存大小限制。

- 空格或下一页键显示下一页。
- 回车键或向下箭头显示下一行。
- 上一页键向上返回一页。
- 向上箭头向上一行。
- Home/End键跳转到缓冲输出的开始/结束。
- 按`q`键退出分页器。如果到达缓冲区的末尾，空格键和回车键也将退出分页器。

未完待續......

源文件：https://wiki.fd.io/view/VPP/Command-line_Interface_(CLI)_Guide